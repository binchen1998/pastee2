# Pastee 发布指南

## 发布新版本步骤

### 1. 修改版本号

需要同时修改以下文件：

**文件 1：Windows** - `Pastee.App/Pastee.App.csproj`

```xml
<Version>3.0.0</Version>  <!-- 改成新版本号 -->
```

**文件 2：Windows 安装程序** - `installer/pastee-setup.iss`

```iss
#define MyAppVersion "3.0.0"  ; 改成新版本号（保持一致）
```

**文件 3：macOS** - `macos/Pastee/Pastee/Info.plist`

```xml
<key>CFBundleShortVersionString</key>
<string>3.0.0</string>  <!-- 改成新版本号 -->
<key>CFBundleVersion</key>
<string>300</string>  <!-- 改成对应的 build 号 -->
```

---

## Windows 发布

### 2. 发布应用

在项目根目录运行：

```powershell
cd Pastee.App
dotnet publish -c Release -r win-x64 --self-contained true -p:PublishSingleFile=false
```

发布后的文件位于：`Pastee.App\bin\Release\netcoreapp3.1\win-x64\publish\`

### 3. 生成安装包

1. 双击打开 `installer/pastee-setup.iss`（需要先安装 [Inno Setup](https://jrsoftware.org/isdl.php)）
2. 点击菜单 **Build → Compile**（或按 **F9**）
3. 等待编译完成

### 4. 获取安装包

安装包生成在：`dist/Pastee-Setup-{版本号}.exe`

### Windows 一键发布脚本（可选）

```powershell
# 发布应用
cd Pastee.App
dotnet publish -c Release -r win-x64 --self-contained true -p:PublishSingleFile=false
cd ..

# 编译安装包（需要 Inno Setup 在 PATH 中）
& "C:\Program Files (x86)\Inno Setup 6\ISCC.exe" installer\pastee-setup.iss

Write-Host "安装包已生成: dist\Pastee-Setup-*.exe"
```

---

## macOS 发布

### 2. 构建安装包

进入 macOS 安装程序目录：

```bash
cd macos/installer
```

#### 方式 A：仅构建（不签名，用于本地测试）

```bash
./build-installer.sh
```

#### 方式 B：构建并签名

```bash
./build-installer.sh --sign \
    --dev-id "Developer ID Application: Your Name (TEAMID)" \
    --installer-id "Developer ID Installer: Your Name (TEAMID)"
```

#### 方式 C：构建、签名并公证（生产环境推荐）

首次设置公证凭据（只需执行一次）：

```bash
xcrun notarytool store-credentials "pastee-notary" \
    --apple-id "your@email.com" \
    --team-id "TEAMID" \
    --password "xxxx-xxxx-xxxx-xxxx"
```

构建命令：

```bash
./build-installer.sh --sign --notarize \
    --dev-id "Developer ID Application: Your Name (TEAMID)" \
    --installer-id "Developer ID Installer: Your Name (TEAMID)" \
    --keychain-profile "pastee-notary"
```

### 3. 获取安装包

安装包生成在：`macos/installer/dist/Pastee-{版本号}.pkg`

### macOS 安装包功能

- ✅ 双击即可安装
- ✅ 安装前自动退出运行中的 Pastee
- ✅ 安装到 `/Applications` 目录
- ✅ 支持代码签名
- ✅ 支持 Apple 公证

更多详细信息请参考：`macos/installer/README.md`

---

## 注意事项

- 发布前确保所有代码已提交到 Git
- 版本号格式：`主版本.次版本.修订号`（如 3.0.0）
- Windows 和 macOS 的版本号应保持一致
- macOS 公证需要有效的 Apple Developer 账户和证书



